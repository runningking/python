#!/usr/bin/env python
# -*- coding: utf-8 -*-

# ------------------------------------------------------
# Name:         程序名称
# Purpose:      一段有趣的Python代码
# Version:      1.0
# Author:       Bingoku
# BLOG:         https://www.cnhzz.com
# EMAIL:        admin@cnhzz.com
# Created:      16/6/6 下午6:19
# Copyright:    (c) Bingoku 16/6/6
# ------------------------------------------------------


import requests

reurl = "http://jslyj.jiasule.com/yjsghdf/site/list/"
Cookie = open("/Users/nibuw/.my_sbin_file/cookie.txt", 'r').read().split("\n")[0]

header = {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:41.0) Gecko/20100101 Firefox/41.0',
          'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
          'Referer': reurl,
          'Cookie': Cookie
          }

add_node_url = "http://jslyj.jiasule.com/yjsghdf/service_manage/node_config/add/"
update_node_url = 'http://jslyj.jiasule.com/yjsghdf/service_manage/node_config/update/'

# nodes = {
# 'taiwan-bgp-1': {"lan":['10.255.43.2'],"wan":['1.32.244.2']},
# 'taiwan-bgp-2': {"lan":['10.255.43.3 '],"wan":['1.32.244.3']},
# 'taiwan-bgp-3': {"lan":['10.255.43.4 '],"wan":['1.32.244.4']},
# 'taiwan-bgp-4': {"lan":['10.255.43.5 '],"wan":['1.32.244.5']},
# 'taiwan-bgp-5': {"lan":['10.255.43.6 '],"wan":['1.32.244.6']},
# 'taiwan-bgp-6': {"lan":['10.255.43.7 '],"wan":['1.32.244.7']},
# 'taiwan-bgp-7': {"lan":['10.255.43.8 '],"wan":['1.32.244.8']},
# 'taiwan-bgp-8': {"lan":['10.255.43.9 '],"wan":['1.32.244.9']},
# 'taiwan-bgp-9': {"lan":['10.255.43.10 '],"wan":['1.32.244.10']},
# 'taiwan-bgp-10':{"lan":['10.255.43.11'],"wan":['1.32.244.11']}

# }

nodes = {
   "tx-xiangyang-cmc1":  {"lan": ["10.255.41.101"], "wan": ["111.47.226.101"]},
   "tx-xiangyang-cmc2":  {"lan": ["10.255.41.102"], "wan": ["111.47.226.102"]},
   "tx-xiangyang-cmc3":  {"lan": ["10.255.41.103"], "wan": ["111.47.226.103"]},
   "tx-xiangyang-cmc4":  {"lan": ["10.255.41.104"], "wan": ["111.47.226.104", "111.47.226.151", "111.47.226.198", "111.47.226.245"]},
   "tx-xiangyang-cmc5":  {"lan": ["10.255.41.105"], "wan": ["111.47.226.105", "111.47.226.152", "111.47.226.199", "111.47.226.246"]},
   "tx-xiangyang-cmc6":  {"lan": ["10.255.41.106"], "wan": ["111.47.226.106", "111.47.226.153", "111.47.226.200", "111.47.226.247"]},
   "tx-xiangyang-cmc7":  {"lan": ["10.255.41.107"], "wan": ["111.47.226.107", "111.47.226.154", "111.47.226.201", "111.47.226.248"]},
   "tx-xiangyang-cmc8":  {"lan": ["10.255.41.108"], "wan": ["111.47.226.108", "111.47.226.155", "111.47.226.202", "111.47.226.249"]},
   "tx-xiangyang-cmc9":  {"lan": ["10.255.41.109"], "wan": ["111.47.226.109", "111.47.226.156", "111.47.226.203", "111.47.226.250"]},
   "tx-xiangyang-cmc10": {"lan": ["10.255.41.110"], "wan": ["111.47.226.110", "111.47.226.157", "111.47.226.204", "111.47.226.251"]},
   "tx-xiangyang-cmc11": {"lan": ["10.255.41.111"], "wan": ["111.47.226.111", "111.47.226.158", "111.47.226.205", "111.47.226.252"]},
   "tx-xiangyang-cmc12": {"lan": ["10.255.41.112"], "wan": ["111.47.226.112", "111.47.226.159", "111.47.226.206", "111.47.226.253"]},
   "tx-xiangyang-cmc13": {"lan": ["10.255.41.113"], "wan": ["111.47.226.113", "111.47.226.160", "111.47.226.207", "111.47.226.254"]},
   "tx-xiangyang-cmc14": {"lan": ["10.255.41.114"], "wan": ["111.47.226.114", "111.47.226.161", "111.47.226.208", "111.47.226.11"]},
   "tx-xiangyang-cmc15": {"lan": ["10.255.41.115"], "wan": ["111.47.226.115", "111.47.226.162", "111.47.226.209", "111.47.226.12"]},
   "tx-xiangyang-cmc16": {"lan": ["10.255.41.116"], "wan": ["111.47.226.116", "111.47.226.163", "111.47.226.210", "111.47.226.13"]},
   "tx-xiangyang-cmc17": {"lan": ["10.255.41.117"], "wan": ["111.47.226.117", "111.47.226.164", "111.47.226.211", "111.47.226.14"]},
   "tx-xiangyang-cmc18": {"lan": ["10.255.41.118"], "wan": ["111.47.226.118", "111.47.226.165", "111.47.226.212", "111.47.226.15"]},
   "tx-xiangyang-cmc19": {"lan": ["10.255.41.119"], "wan": ["111.47.226.119", "111.47.226.166", "111.47.226.213", "111.47.226.16"]},
   "tx-xiangyang-cmc20": {"lan": ["10.255.41.120"], "wan": ["111.47.226.120", "111.47.226.167", "111.47.226.214", "111.47.226.17"]},
   "tx-xiangyang-cmc21": {"lan": ["10.255.41.121"], "wan": ["111.47.226.121", "111.47.226.168", "111.47.226.215", "111.47.226.18"]},
   "tx-xiangyang-cmc22": {"lan": ["10.255.41.122"], "wan": ["111.47.226.122", "111.47.226.169", "111.47.226.216", "111.47.226.19"]},
   "tx-xiangyang-cmc23": {"lan": ["10.255.41.123"], "wan": ["111.47.226.123", "111.47.226.170", "111.47.226.217", "111.47.226.20"]},
   "tx-xiangyang-cmc24": {"lan": ["10.255.41.124"], "wan": ["111.47.226.124", "111.47.226.171", "111.47.226.218", "111.47.226.21"]},
   "tx-xiangyang-cmc25": {"lan": ["10.255.41.125"], "wan": ["111.47.226.125", "111.47.226.172", "111.47.226.219", "111.47.226.22"]},
   "tx-xiangyang-cmc26": {"lan": ["10.255.41.126"], "wan": ["111.47.226.126", "111.47.226.173", "111.47.226.220", "111.47.226.23"]},
   "tx-xiangyang-cmc27": {"lan": ["10.255.41.127"], "wan": ["111.47.226.127", "111.47.226.174", "111.47.226.221", "111.47.226.24"]},
   "tx-xiangyang-cmc28": {"lan": ["10.255.41.128"], "wan": ["111.47.226.128", "111.47.226.175", "111.47.226.222", "111.47.226.25"]},
   "tx-xiangyang-cmc29": {"lan": ["10.255.41.129"], "wan": ["111.47.226.129", "111.47.226.176", "111.47.226.223", "111.47.226.26"]},
   "tx-xiangyang-cmc30": {"lan": ["10.255.41.130"], "wan": ["111.47.226.130", "111.47.226.177", "111.47.226.224", "111.47.226.27"]},
   "tx-xiangyang-cmc31": {"lan": ["10.255.41.131"], "wan": ["111.47.226.131", "111.47.226.178", "111.47.226.225", "111.47.226.28"]},
   "tx-xiangyang-cmc32": {"lan": ["10.255.41.132"], "wan": ["111.47.226.132", "111.47.226.179", "111.47.226.226", "111.47.226.29"]},
   "tx-xiangyang-cmc33": {"lan": ["10.255.41.133"], "wan": ["111.47.226.133", "111.47.226.180", "111.47.226.227"]},
   "tx-xiangyang-cmc34": {"lan": ["10.255.41.134"], "wan": ["111.47.226.134", "111.47.226.181", "111.47.226.228"]},
   "tx-xiangyang-cmc35": {"lan": ["10.255.41.135"], "wan": ["111.47.226.135", "111.47.226.182", "111.47.226.229"]},
   "tx-xiangyang-cmc36": {"lan": ["10.255.41.136"], "wan": ["111.47.226.136", "111.47.226.183", "111.47.226.230"]},
   "tx-xiangyang-cmc37": {"lan": ["10.255.41.137"], "wan": ["111.47.226.137", "111.47.226.184", "111.47.226.231"]},
   "tx-xiangyang-cmc38": {"lan": ["10.255.41.138"], "wan": ["111.47.226.138", "111.47.226.185", "111.47.226.232"]},
   "tx-xiangyang-cmc39": {"lan": ["10.255.41.139"], "wan": ["111.47.226.139", "111.47.226.186", "111.47.226.233"]},
   "tx-xiangyang-cmc40": {"lan": ["10.255.41.140"], "wan": ["111.47.226.140", "111.47.226.187", "111.47.226.234"]},
   "tx-xiangyang-cmc41": {"lan": ["10.255.41.141"], "wan": ["111.47.226.141", "111.47.226.188", "111.47.226.235"]},
   "tx-xiangyang-cmc42": {"lan": ["10.255.41.142"], "wan": ["111.47.226.142", "111.47.226.189", "111.47.226.236"]},
   "tx-xiangyang-cmc43": {"lan": ["10.255.41.143"], "wan": ["111.47.226.143", "111.47.226.190", "111.47.226.237"]},
   "tx-xiangyang-cmc44": {"lan": ["10.255.41.144"], "wan": ["111.47.226.144", "111.47.226.191", "111.47.226.238"]},
   "tx-xiangyang-cmc45": {"lan": ["10.255.41.145"], "wan": ["111.47.226.145", "111.47.226.192", "111.47.226.239"]},
   "tx-xiangyang-cmc46": {"lan": ["10.255.41.146"], "wan": ["111.47.226.146", "111.47.226.193", "111.47.226.240"]},
   "tx-xiangyang-cmc47": {"lan": ["10.255.41.147"], "wan": ["111.47.226.147", "111.47.226.194", "111.47.226.241"]},
   "tx-xiangyang-cmc48": {"lan": ["10.255.41.148"], "wan": ["111.47.226.148", "111.47.226.195", "111.47.226.242"]},
   "tx-xiangyang-cmc49": {"lan": ["10.255.41.149"], "wan": ["111.47.226.149", "111.47.226.196", "111.47.226.243"]},
   "tx-xiangyang-cmc50": {"lan": ["10.255.41.150"], "wan": ["111.47.226.150", "111.47.226.197", "111.47.226.244"]}
 }

node_data = {
    'node_name': 'tx-xiangyang-cmc1',
    'node_id': '',
    'idc': '襄阳移动',
    'ttl': '200',
    'wan': '183.222.96.193',
    'lan': '10.255.19.63',
    'province': 'Hubei',
    'is_vm': '0',
    'limit_bandwidth': '10000',
    'is_online': '1',  # 是否上线(1:上线 0_2:临时下线 0_1:故障下线)
    'note': '襄阳移动抗D添加等待测试上线-吴彬',
    'machine_id': '0',
    'group_names[]': 'group_20',
    'group_isps[]': '3-', # 3 移动 1联通 2电信 4其它
    'group_weights[]': '200'
}

for v, k in nodes.iteritems():
    # print k['wan'],k['lan']
    # 整理内网IP、机器ID号
    if 'c' in v[-2:]:
        new_lan_machine_id = {'lan': k['lan'][0], 'machine_id': 95278 + int(v[-1:])}
        # print 90000+int(v[-1:])
        node_data.update(new_lan_machine_id)
    else:
        new_lan_machine_id = {'lan': k['lan'][0], 'machine_id': 95278 + int(v[-2:])}
        # print 90000+int(v[-2:])
        node_data.update(new_lan_machine_id)

    # 整理节点名字
    for i in k['wan']:

        if k['wan'].index(i) == 0:
            node_name = {'node_name': "%s" % v, 'wan': i, 'group_weights[]': '200'}
            node_data.update(node_name)
            # print node_data
            # 正式提交节点信息
            # r = requests.post(add_node_url, data=node_data, headers=header)
            # print r.json()['message'],node_data['lan']
        else:
            node_name = {'node_name': "%s-%s" % (v, k['wan'].index(i)), 'wan': i, 'group_weights[]': '50', 'lan': i}
            node_data.update(node_name)

        # 测试输出的字段是否已经完整
        # print node_data

        # 正式提交节点信息
        r = requests.post(add_node_url, data=node_data, headers=header)
        print r.json()['message'], node_data['lan']
